<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Yêu cầu 3 task 1</title>
</head>
<body>
<script>
    function addNewCustomer() {
        let check = false;
        let nhap = prompt("Nhập họ và tên:");
        // cach 1 dinh dang name
        // let dem = 0;
        // let lowNhap = nhap.toLowerCase();
        // let name = "";
        // for (; dem < nhap.length; dem++) {
        //     if (lowNhap.charAt(dem) == " " && lowNhap.charAt(dem + 1) == " ") {
        //         continue;
        //     }
        //     if (dem == 0 || lowNhap.charAt(dem - 1) == " ") {
        //         name = name + lowNhap.charAt(dem).toUpperCase();
        //         continue;
        //     }
        //     name = name + lowNhap.charAt(dem);
        // }
        // alert(name);
        //cách 2 :
        nhap.trim().toLowerCase();// Hàm trim dung dể cắt các kí tự tống ở hai đầu 2 bên !/////
        let name = "";
        for (let i = 0; i < nhap.length; i++) {
            if (nhap.charAt(i) === " " && nhap.charAt(i + 1) === " ") {
                continue;
            }
            if (i == 0 || nhap.charAt(i - 1) === " ") {
                name += nhap.charAt(i).toUpperCase();
                continue;
            }
            name += nhap.charAt(i);
        }
        alert(name);
        //
        //
        //
        //
        //
        //Kiểm tra tính hợp lệ của cmnd
        let cmnd;
        do {
            cmnd = prompt("input cmnd :");
            if (!isNaN(cmnd)) {
                cmnd = Number.parseFloat(cmnd);
            }
            if (!Number.isInteger(cmnd)) {
                alert("CMND không đúng định dạng");
                continue;
            }
            if (cmnd < 10000000 || cmnd > 99999999) {
                alert("CMND không đúng định dạng");
                continue;
            }
            check = true;
        } while (!check);
        check = false;
        //định dạng ngày sinh
        let birthday;
        do {
            birthday = prompt("input birthday : ");
            if (birthday.charAt(2) === "/" && birthday.charAt(5) === "/") {
                let day = birthday.substring(0, 2);
                let month = birthday.substring(3, 5);
                let year = birthday.substring(6, 9);
                if (day < 32 && month < 13) {
                    check = true;
                }
                if (!check) {
                    alert("Ngày sinh không đúng định dạng !");
                }
            }
        } while (!check)
        check = false;
        //
        //
        //
        //
        //
        //
        // Kiểm tra tính hợp lệ của email
        let email;
        do {
            let countAt = 0;
            let countDoc = 0;
            email = prompt(" Nhập địa chỉ email : ");
            for (let i = 0; i < email.length; i++) {
                if (email.charAt(i) === "@") {
                    countAt++;
                }
                for (let j = i + 1; j < email.length; j++) {
                    if (email.charAt(i) === ".") {
                        countDoc++;
                    }
                }
            }
            if (countAt != 1 || countDoc < 1) {
                alert("Bạn nhập sai định dạng email !")
            } else {
                check = true;
            }
        } while (check == false);
        check = false;
        ///////////////////////////////////////////////////////////
        // do{
        //      email = prompt("input email : ");
        // }while (!isEmail());
        // // kiếm tra định dạng email
        // function isEmail(){
        //     let at = email.indexOf("@");
        //     let dot = email.lastIndexOf(".");
        //     let space = email.indexOf(" ");
        //     if((at == 1)
        //         && (at != 0)
        //         && (dot == 1)
        //         && (space == -1)
        //         && ( dot > at + 1 )
        //         && (dot < email.length -1)) {
        //         return true;
        //     }else {
        //         return false;
        //     }
        // }
        // Chọn địa chỉ
        //
        //
        //
        //
        let address;
        let chooseAddress = prompt("Nhấn 1 chọn Đà Nẵng : "
            + "\n Nhấn 2 để chọn Huế"
            + "\n Nhấn 3 để chọn Quảng Nam"
            + "\n Nhấn số khác để chọn tự nhập"
        );
        let chAdd;
        //chAdd tính giảm giá theo địa chỉ
        switch (chooseAddress) {
            case '1' :
                address = "Đà Nẵng";
                chAdd = 20;
                break;
            case '2' :
                address = "Huế";
                chAdd = 10;
                break;
            case '3' :
                address = "Quảng Nam";
                chAdd = 5;
                break;
            default :
                address = prompt("Nhập tỉnh cần nhập : ");
                chAdd = 0;
        }
        // chọn loại dịch vụ
        //
        //
        //
        //
        //
        let typeService, chSe;
        let chService = prompt("Nhấn 1: Villa"
            + "\n Nhấn 2: House"
            + "\n Nhấn 3: Room"
        );
        switch (chService) {
            case '1':
                typeService = "Villa";
                chSe = 500;
                break;
            case '2':
                typeService = "House";
                chSe = 300;
                break;
            case '3':
                typeService = "Room";
                chSe = 100;
                break;
            default :
                typeService = alert("Loại khác");
                chSe = 0;
        }
        //
        //
        //
        //
        let typeRoom = prompt("input typeRoom : ");
        // Loại khách hàng
        //
        //
        //
        //
        //
        let typeCustomer, chCus;
        let chCustomer = prompt("Nhấn 1: Customer là Diamond "
            + "\n Nhấn 2: Customer là Platium"
            + "\n Nhấn 3: Customer là Gold"
            + "\n Nhấn 4: Customer là Silver"
            + "\n Nhấn 5: Customer là Member"
        );
        switch (chCustomer) {
            case '1' :
                typeCustomer = "Diamond";
                chCus = 15;
                break;
            case '2' :
                typeCustomer = "Platium";
                chCus = 10;
                break;
            case '3' :
                typeCustomer = "Gold";
                chCus = 5;
                break;
            case '4' :
                typeCustomer = "Silver";
                chCus = 2;
                break;
            case '5' :
                typeCustomer = "Member";
                chCus = 0;
                break;
            default :
                typeCustomer = alert("Loại khách hàng khác")
        }
        //
        //
        //
        // định dạng giảm giá
        let discount;
        do {
            discount = parseInt(prompt("input discount : "));
            if (!isNaN(discount)) {
                discount = Number.parseFloat(discount);
                check = true;
            }
            if (!check) {
                alert("Giảm giá không phải là một số nguyên !");
            }
        } while (!check)
        check = false;
        //
        //
        //
        //
        //

        let included;
        do {
            included = prompt("input included : ");
            if (!isNaN(included)) {
                included = Number.parseFloat(included);
                check = true;
            }
            if (!check) {
                alert("Số người đi kèm không phải là một số nguyên !");
            }
        } while (!check)
        //số ngày thuê
        //
        //
        //
        //
        let chDay;
        let renDays;
        do {
            renDays = parseInt(prompt("input renDays : "));
            if (!isNaN(renDays)) {
                renDays = Number.parseFloat(renDays);
                if (Number.isInteger(renDays)) {
                    check = true;
                }
                if (!check) {
                    alert("Ngày thuê không phải là số nguyên !");
                }
            }
        } while (!check)
        check = false;
        //tính giảm giá theo ngày
        if (renDays >= 7) {
            chDay = 30;
        } else if (renDays >= 5) {
            chDay = 20;
        } else if (renDays >= 2) {
            chDay = 10;
        } else {
            chDay = 0;
        }
        //
        //
        //
        //
        //giảm giá theo năm sinh và tuổi
        let currentYear = new Date().getFullYear();
        let year = new Date(birthday).getFullYear();
        let chAge;
        let ageCustomer = currentYear - year;
        if (ageCustomer >= 30 && address == "Đà Nẵng") {
            chAge = 2;
        } else if (ageCustomer >= 20 && address == "Đà Nẵng") {
            chAge = 1;
        } else chAge = 0;
        //tổng giảm giá
        discount = discount + chDay + chAdd + chAge + chCus;
        //tỏng tiền phải trả
        let total = chSe * renDays * (1 - (discount / 100));
    }

    function display() {
        let choose = "";
        for (let i = 0; i < arrNameCustomer.length; i++) {
            for (let j = 0; j < arrNameCustomer[i].length; j++) {
                choose += i + 1 + "." + arrNameCustomer[i][0];
            }
            alert(choose);
        }
        prompt("Chọn tên muốn hiển thị !");
        let chooseDisplay = parseInt(prompt(choose));
        alert("Tên : " + chooseDisplay[0] +
            "\n cmnd : " + chooseDisplay[1] +
            "\n Ngày sinh : " + chooseDisplay[2] +
            "\n email : " + chooseDisplay[3] +
            "\n Địa chỉ " + chooseDisplay[4] +
            "\n Loại dịch vụ  : " + chooseDisplay[5] +
            "\n Loai phòng : " + chooseDisplay[6] +
            "\n Loại khách hàng : " + chooseDisplay[7] +
            "\n giảm giá : " + chooseDisplay[8] +
            "\n Số người : " + chooseDisplay[9] +
            "\n Số ngày thuê : " + chooseDisplay[10] +
            "Tổng tiền trả :" + total);
    }

    function edit() {
        let choose = prompt("Nhấn 1 để sửa tên"
            + "\n Nhấn 2 để sửa cmnd"
            + "\n Nhấn 3 để sửa ngày sinh"
            + "\n Nhấn 4 để sửa email"
            + "\n Nhấn 5 để sửa address"
            + "\n Nhấn 6 để sửa typeService"
            + "\n Nhấn 7 để sửa typeRoom"
            + "\n Nhấn 8 để sửa typeCustomer"
            + "\n Nhấn 9 để sửa discount"
            + "\n Nhấn 10 để sửa included"
            + "\n Nhấn 11 để sửa renDays"
        );
        switch (choose) {
            case '1':
                name = prompt("nhập lại tên : ");
                break;
            case '2':
                cmnd = prompt("nhập lại cmnd : ");
                break;
            case '3':
                birthday = prompt("nhập lại ngày sinh : ");
                break;
            case '4':
                email = prompt("nhập lại email : ");
                break;
            case '5':
                address = prompt("nhập lại address : ");
                break;
            case '6':
                typeService = prompt("nhập lại typeService : ");
                break;
            case '7':
                typeRoom = prompt("nhập lại typeRoom : ");
                break;
            case '8':
                typeCustomer = prompt("nhập lại typeCustomer : ");
                break;
            case '9':
                discount = prompt("nhập lại discount : ");
                break;
            case '10':
                included = prompt("nhập lại included : ");
                break;
            case '11':
                renDays = prompt("nhập lại renDays : ");
                break;
        }
    }

    let arrNameCustomer = [];
    displayMainMenu();
    let check = true;

    function displayMainMenu() {
        while (true) {
            let choose = prompt("Nhấn 1 để thêm phần tử " +
                "\n Nhấn 2 để hiển thị " +
                "\n Nhấn 3 để sửa thông tin " +
                "\n Nhấn 4 để xóa thông tin " +
                "\n Nhấn 5 để thoát !");
            switch (choose) {
                case "1":
                    let arr = addNewCustomer();
                    arrNameCustomer.push(arr);
                    break;
                case "2":
                    display();
                    break;
                case '3':
                    break;
                case '4':
                    break;
                case '5':
                    confirm("Bạn có thật sự muốn thoát !");
                    break;
            }
        }
    }

    displayMainMenu()
</script>
</body>
</html>